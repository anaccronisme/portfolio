---
interface Props {
  type: 'WebSite' | 'BlogPosting' | 'Person' | 'BreadcrumbList';
  data: Record<string, unknown>;
}

const { type, data } = Astro.props;

function generateJsonLd(type: string, data: Record<string, unknown>) {
  const baseContext = { '@context': 'https://schema.org' };

  switch (type) {
    case 'WebSite':
      return {
        ...baseContext,
        '@type': 'WebSite',
        name: data.name,
        url: data.url,
        description: data.description,
        potentialAction: {
          '@type': 'SearchAction',
          target: `${data.url}?s={search_term_string}`,
          'query-input': 'required name=search_term_string',
        },
      };

    case 'BlogPosting':
      return {
        ...baseContext,
        '@type': 'BlogPosting',
        headline: data.title,
        description: data.description,
        image: data.image,
        datePublished: data.publishedTime,
        dateModified: data.modifiedTime || data.publishedTime,
        author: {
          '@type': 'Person',
          name: data.author,
        },
        publisher: {
          '@type': 'Organization',
          name: data.siteName,
          logo: {
            '@type': 'ImageObject',
            url: data.logo,
          },
        },
        mainEntityOfPage: {
          '@type': 'WebPage',
          '@id': data.url,
        },
      };

    case 'Person':
      return {
        ...baseContext,
        '@type': 'Person',
        name: data.name,
        url: data.url,
        image: data.image,
        jobTitle: data.jobTitle,
        description: data.description,
        sameAs: data.sameAs,
      };

    case 'BreadcrumbList':
      return {
        ...baseContext,
        '@type': 'BreadcrumbList',
        itemListElement: (data.items as Array<{ name: string; url: string }>).map(
          (item, index) => ({
            '@type': 'ListItem',
            position: index + 1,
            name: item.name,
            item: item.url,
          })
        ),
      };

    default:
      return { ...baseContext, '@type': type, ...data };
  }
}

const jsonLd = generateJsonLd(type, data);
---

<script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
